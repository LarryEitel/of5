"use strict";angular.module("ofApp",["restangular","ui.bootstrap","ui"]).constant("XCHGLAB_CONFIG",{API_KEY:"testkey"}).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl"}).when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://exi.xchg.com/api"),e.setListTypeIsArray(!1),e.setResponseExtractor(function(e){return e})}]),angular.module("ofApp").controller("MainCtrl",["$scope","Restangular",function(e,r){var o=r.all("plcs");e.plcs=o.getList()}]),angular.module("ofApp").controller("PlcsCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,r,o,t,n){r.gMap={myMap:void 0},r.gMap.latLngFromLl=function(e){var r=e.split(",");return new google.maps.LatLng(r[0],r[1])};var a=r.gMap.latLngFromLl("9.988002927, -84.20538052916"),s={ll:a,cngSlug:"crherbs",cngAreaSlug:"crherbsca",cngAreaTerrSlug:"crherbsca12",q:"",sort:"bdry,w",filter:"cngAreaTerr:crherbs",pp:5,pg:5};r.gMap.myMarkers=[],r.gMap.myMarkers.push(new google.maps.Marker({map:r.gMap.myMap,position:s.ll})),r.gMap.reLoadMkrs=function(){r.gMap.myMarkers.push(new google.maps.Marker({map:r.gMap.myMap,position:ll}))},r.gMap.addMarker=function(e){r.gMap.myMarkers.push(new google.maps.Marker({map:r.gMap.myMap,position:e.latLng}))},r.gMap.setMarkerPosition=function(e,r,o){e.setPosition(new google.maps.LatLng(r,o))},r.gMap.mapOptions={center:s.ll,zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP},r.$watch("myMap",function(){r.setHome()}),r.setHome=function(){r.homeMarker=new google.maps.Marker({map:r.gMap.myMap,position:r.gMap.mapOptions.center})},r.items=[],r.lastItemsWithInfo=null,r.maxId=null,r.q=t.q||s.q,r.pp=t.pp||s.pp,r.pg=t.pg||s.pg,r.sort=t.sort||s.sort,r.args=s,r.cngs=[{slug:"crherbs",nam:"Belen Sur"}],r.cngAreas=[{bdry:"crherbs",slug:"crherbsca",nam:"Cariari"},{bdry:"crherbs",slug:"crherbsla",nam:"Los Arcos"}],r.cngAreaTerrs=[{bdry:"crherbsca",slug:"crherbsca01",nam:"CA-01 (bogus)"},{bdry:"crherbsca",slug:"crherbsca12",nam:"CA-12"},{bdry:"crherbsla",slug:"crherbsla01",nam:"LA-01 (bogus)"},{bdry:"crherbsla",slug:"crherbsla02",nam:"LA-02 (bogus)"}],t.sort||(t.sort=s.sort),e.returnRoute=o.$$url,r.location=o,r.routeParams=t,r.$watch("cngAreaTerrId",function(e){o.search("cngAreaTerrId",e),r.cngAreaTerrId=e}),r.$watch("routeParams",function(e){return angular.forEach(e,function(e,t){return"where"!==t?(r[t]=e,o.search(t,e)):void 0})},!0);var l=n.all("plcs");r.doClear=function(){r.q=r.location.q=r.routeParams.q=s.q,r.doSearch()},r.doSearch=function(){var e={},n={};r.q&&(n.dNam={$regex:r.q,$options:"i"}),"boolean"!=typeof t.cngAreaTerrId&&t.cngAreaTerrId&&(n.bdry=t.cngAreaTerrId),n&&(e.where=JSON.stringify(n)),t.sort&&(e.sort=t.sort),l.getList(e).then(function(e){r.items=e._items,r.q&&o.search("q",r.q)},function(){console.log("Oops error from server :(")})},r.add=function(){var e="doc="+JSON.stringify(r.newItem),o=n.all("plcs");o.post(e).then(function(e){r.newItem._id=e.doc._id,r.items.push(r.newItem),r.newItem={},r.myForm.$setPristine(),r.myForm.$pristine=!0})},r.remove=function(e){var a=confirm("Are you absolutely sure you want to delete?");if(a){var s=r.items[e],l=n.one("plcs",s._id);l.remove().then(function(){r.items.splice(e,1)},function(){return console.log("Oops error from server :("),o.path("/plc/"+t.id)})}},r.insert=function(){return o.path("/plc/insert")},r.edit=function(e){var t=r.items[e];return o.path("/plc/"+t._id+"/edit")},r.view=function(e){var t=r.items[e];return o.path("/plc/"+t._id)},r.doSearch()}]).controller("PlcFormCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,r,o,t,n){var a="/plc/insert"===o.$$path;if(a)r.mode="Add New";else{r.mode="Update";var s=n.one("plcs",t.id);s.get().then(function(e){r.dNam=e.dNam,r.item={},r.item._id=e._id||null,r.item.bdry=e.bdry||"",r.item.nam=e.nam||"",r.item.namS=e.namS||"",r.item.addr=e.addr,r.item.desc=e.desc,r.item.tags=void 0!==e.tags?e.tags.join(","):"",void 0!==e.pt&&(r.item.lng=e.pt[0],r.item.lat=e.pt[1])},function(){console.log("Oops error from server :(")})}r.remove=function(e){var r=confirm("Are you absolutely sure you want to delete?");if(r){var a=n.one("plcs",e._id);a.remove().then(function(){return o.path("/plcs")},function(){return console.log("Oops error from server :("),o.path("/plc/"+t.id)})}},r.save=function(r){var o={};if(console.log("save"),a){o="doc="+JSON.stringify(r);var t=n.all("plcs");t.post(o).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})}else r.tags=void 0!==r.tags&&r.tags>""?r.tags.split(","):[],void 0!==r.lng&&void 0!==r.lat&&(r.pt=[r.lng,r.lat],delete r.lat,delete r.lng),delete r._id,console.log("item",r),o=JSON.stringify({actions:{$set:{flds:r}}}),s.customPUT(void 0,void 0,void 0,o).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})},r.abandonChanges=function(){return o.path("/plc/"+r.item._id)}}]).controller("PlcViewCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,r,o,t,n){var a=n.one("plcs",t.id);a.get().then(function(e){r.item=e,void 0!==e.pt&&(r.lng=e.pt[0],r.lat=e.pt[1])},function(){console.log("Oops error from server :(")}),r.remove=function(r){var o=confirm("Are you absolutely sure you want to delete?");if(o){var t=n.one("plcs",r._id);t.remove().then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :("),window.location.href="#"+e.returnRoute})}},r.edit=function(e){return o.path("/plc/"+e._id+"/edit")}}]);