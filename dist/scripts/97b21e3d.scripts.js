"use strict";angular.module("of5App",["restangular","ui.bootstrap","ui.keypress"]).constant("XCHGLAB_CONFIG",{API_KEY:"testkey"}).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl"}).when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://exi.xchg.com/api"),e.setListTypeIsArray(!1),e.setResponseExtractor(function(e){return e})}]),angular.module("of5App").controller("MainCtrl",["$scope","Restangular",function(e,t){var r=t.all("plcs");e.plcs=r.getList()}]),angular.module("of5App").controller("PlcsCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){e.items=[],e.lastItemsWithInfo=null,e.maxId=null,e.itemsPerPage=5,e.page=1,r.q&&(e.search=r.q),e.location=t,e.routeParams=r,e.$watch("routeParams",function(e){return angular.forEach(e,function(e,r){return t.search(r,e)})},!0),e.$watch("search",function(e){return e?t.search("q",e):(delete t.q,void 0)},!0);var n=o.all("plcs"),l={};e.doClear=function(){e.search="",e.location.q="",e.routeParams.q="",e.doSearch()},e.doSearch=function(){e.search?l.where=JSON.stringify({dNam:{$regex:e.search,$options:"i"}}):l={},n.getList(l,{maxResults:e.itemsPerPage}).then(function(t){e.items=t._items},function(){console.log("Oops error from server :(")})},e.add=function(){var t="doc="+JSON.stringify(e.newItem),r=o.all("plcs");r.post(t).then(function(t){e.newItem._id=t.doc._id,e.items.push(e.newItem),e.newItem={},e.myForm.$setPristine(),e.myForm.$pristine=!0})},e.remove=function(n){var l=confirm("Are you absolutely sure you want to delete?");if(l){var i=e.items[n],s=o.one("plcs",i._id);s.remove().then(function(){e.items.splice(n,1)},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.insert=function(){return t.path("/plc/insert")},e.edit=function(r){var o=e.items[r];return t.path("/plc/"+o._id+"/edit")},e.view=function(r){var o=e.items[r];return t.path("/plc/"+o._id)},e.doSearch()}]).controller("PlcFormCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){var n="/plc/insert"===t.$$path;if(n);else{var l=o.one("plcs",r.id);l.get().then(function(t){e.item={},e.item.lbl=t.lbl,void 0!==t.pts&&(e.item.lat=t.pts[0],e.item.lng=t.pts[1])},function(){console.log("Oops error from server :(")})}e.remove=function(e){var n=confirm("Are you absolutely sure you want to delete?");if(n){var l=o.one("plcs",e._id);l.remove().then(function(){return t.path("/plcs")},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.save=function(e){var r={};if(n){r="doc="+JSON.stringify(e);var i=o.all("plcs");i.post(r).then(function(){return t.path("/plcs/")},function(){console.log("Oops error from server :(")})}else e.pts=[e.lat,e.lng],delete e.lat,delete e.lng,r=JSON.stringify({actions:{$set:{flds:e}}}),l.customPUT(void 0,void 0,void 0,r).then(function(e){return t.path("/plc/"+e.doc._id)},function(){console.log("Oops error from server :(")})},e.abandonChanges=function(){return t.path("/plc/"+e.item._id)}}]).controller("PlcViewCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){var n=o.one("plcs",r.id);n.get().then(function(t){e.item=t,void 0!==t.pts&&(e.lat=t.pts[0],e.lng=t.pts[1])},function(){console.log("Oops error from server :(")}),e.remove=function(e){var n=confirm("Are you absolutely sure you want to delete?");if(n){var l=o.one("plcs",e._id);l.remove().then(function(){return t.path("/plcs")},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.edit=function(e){return t.path("/plc/"+e._id+"/edit")}}]);