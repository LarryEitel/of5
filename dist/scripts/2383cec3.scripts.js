"use strict";(function(t){t.userRoles={"public":1,user:2,admin:4},t.accessLevels={"public":7,anon:1,user:6,admin:4}})("undefined"==typeof exports?this.routingConfig={}:exports),function(){var t,e,o,r,n=function(t,e){return function(){return t.apply(e,arguments)}};r=function(t){return t.lat+","+t.lng},o=function(t){var e;return e=t.split(","),{lat:e[0],lng:e[1]}},t=function(){function t(t){this.addMarker=n(this.addMarker,this),this.onTypeChange=n(this.onTypeChange,this),this.onZoomChange=n(this.onZoomChange,this),this.updateLocation=n(this.updateLocation,this),this.onCenterChanged=n(this.onCenterChanged,this),this.resizeMapEl=n(this.resizeMapEl,this),this.onDragEnd=n(this.onDragEnd,this),this.setCenter=n(this.setCenter,this),this.onDragStart=n(this.onDragStart,this),this.addPlcMkr=n(this.addPlcMkr,this),this.onClick=n(this.onClick,this);var e;this.rootScope=t.rootScope,this.dragging=0,this.location=t.location,this.routeParams=t.routeParams,this.zoom=parseInt(this.location.search().z)||t.zoom,this.mapType=this.location.search().t||t.mapType,this.ll=this.location.search().ll||t.ll,this.center=this.ll?o(this.ll):t.center,this.routeParams.ll=this.ll,this.mapEl=$("#map"),this.mapTypes={m:"roadmap",h:"hybrid"},this.map=new google.maps.Map(this.mapEl[0],{zoom:this.zoom,center:new google.maps.LatLng(this.center.lat,this.center.lng),mapTypeId:this.mapTypes[this.mapType]}),e=google.maps.event.addListener,e(this.map,"center_changed",this.onCenterChanged),e(this.map,"maptypeid_changed",this.onTypeChange),e(this.map,"zoom_changed",this.onZoomChange),e(this.map,"dragstart",this.onDragStart),e(this.map,"dragend",this.onDragEnd),e(this.map,"click",this.onClick),this.rootScope.protocol=this.location.protocol(),this.rootScope.host=this.location.host(),this.rootScope.mapCenter=this.center,this.rootScope.mapZoom=this.zoom,this.rootScope.mapTypeId=this.mapTypeId}return t.prototype.onClick=function(t){return this.rootScope.selectedItemIndex>-1?this.addPlcMkr(t.latLng.lat(),t.latLng.lng()):void 0},t.prototype.addPlcMkr=function(t,o){var r,n;return r=this.icon(this.rootScope.selectedItem),n=new e(this.map,t,o,r),this.rootScope.selectedItem.pt=[t,o],this.rootScope.selectedItemIndex=-1,this.rootScope.$$phase||this.rootScope.$apply()},t.prototype.onDragStart=function(){return this.dragging=!0,!0},t.prototype.setCenter=function(){return console.log("setCenter",this.center)},t.prototype.onDragEnd=function(){return this.dragging=!1,this.onCenterChanged()},t.prototype.resizeMapEl=function(){},t.prototype.onCenterChanged=function(){var t;return t=this.map.getCenter(),this.center.lat=t.lat(),this.center.lng=t.lng(),this.dragging?void 0:(this.rootScope.mapCenter=this.center,this.ll=r(this.center),this.routeParams.ll=this.ll,this.updateLocation())},t.prototype.updateLocation=function(){return this.rootScope.$$phase||this.rootScope.$apply()},t.prototype.onZoomChange=function(){return this.rootScope.mapZoom=this.zoom=this.map.getZoom(),this.routeParams.z=this.zoom,this.updateLocation()},t.prototype.onTypeChange=function(){return console.log("onTypeChange"),this.mapTypeId=this.map.getMapTypeId(),this.rootScope.mapTypeId=this.mapTypeId[0],this.routeParams.t=this.mapTypeId[0],this.updateLocation()},t.prototype.addMarker=function(t,o){var r;return console.log("addMarker",t,o),console.log("icon",this.icon()),r=new e(this.map,t,o),console.log("marker",r)},t}(),e=function(){function t(t,e,o,r,i){this.map=t,this.lat=e,this.lng=o,this.icon=null!=r?r:null,this.draggable=null!=i?i:!0,this.click=n(this.click,this),this.show=n(this.show,this),this.dragend=n(this.dragend,this),this.position=new google.maps.LatLng(this.lat,this.lng),this.render(),this.render()}return t.prototype.render=function(){return this.marker=new google.maps.Marker({draggable:this.draggable,icon:this.icon}),google.maps.event.addListener(this.marker,"dragend",this.dragend),google.maps.event.addListener(this.marker,"click",this.click),this.show()},t.prototype.dragend=function(){return console.log("dragend")},t.prototype.show=function(){return this.marker.setPosition(this.position),this.marker.setMap(this.map)},t.prototype.click=function(){return console.log("mkrClick")},t}(),angular.module("ofApp",["restangular","ngCookies","ui.bootstrap"]),angular.module("ofApp").config(["$httpProvider",function(t){return t.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",t.defaults.headers.post["Content-Type"]}]),angular.module("ofApp").config(["RestangularProvider",function(t){return t.setBaseUrl("http://exi.xchg.com/api"),t.setListTypeIsArray(!1),t.setResponseExtractor(function(t,e,o){return"users"===o&&"getList"===e&&localStorage.setItem("lsuser",JSON.stringify(t._items[0])),t})}]),angular.module("ofApp").config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,o){var r,n;return r=routingConfig.accessLevels,t.when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl",access:r.anon}),t.when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl",access:r.anon}),t.when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl",access:r.anon}),t.when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl",access:r.anon}),t.when("/",{templateUrl:"views/partials/home.html",controller:"HomeCtrl",access:r.user}),t.when("/login",{templateUrl:"views/partials/login.html",controller:"LoginCtrl",access:r.anon}),t.when("/logout",{templateUrl:"views/partials/logout.html",controller:"LogoutCtrl",access:r.user}),t.when("/register",{templateUrl:"views/partials/register.html",controller:"RegisterCtrl",access:r.anon}),t.when("/private",{templateUrl:"/partials/private",controller:"PrivateCtrl",access:r.user}),t.when("/admin",{templateUrl:"/partials/admin",controller:"AdminCtrl",access:r.admin}),t.when("/404",{templateUrl:"views/partials/404.html",access:r["public"]}),t.otherwise({redirectTo:"/404"}),n=["$location","$q",function(t,e){var o,r;return r=function(t){return t},o=function(o){return 401===o.status?(t.path("/login"),e.reject(o)):e.reject(o)},function(t){return t.then(r,o)}}],o.responseInterceptors.push(n)}]),r=function(t){return t.lat+","+t.lng},o=function(t){var e;return e=t.split(","),{lat:e[0],lng:e[1]}},angular.module("ofApp").factory("GoogleMap",["$rootScope","$location","$routeParams",function(e,o,n){var i,s,a,l,c;return i={lat:9.993552791991132,lng:-84.20888416469096},s=i,a=16,l={rootScope:e,location:o,routeParams:n,zoom:a,mapType:"m",ll:r(s),center:{lat:s.lat,lng:s.lng}},c=0,new t(l)}]),angular.module("ofApp").run(["$rootScope","$location","Auth",function(t,e,o){return t.$on("$routeChangeStart",function(r,n){return t.error=null,(o.authorize(n.access)?void 0:o.isLoggedIn())?void 0:e.path("/login")}),t.appInitialized=!0}])}.call(this),function(){angular.module("ofApp").factory("Auth",["Restangular","$http","$rootScope","$cookieStore",function(t,e,o){var r,n;return r=routingConfig.accessLevels,n=routingConfig.userRoles,localStorage.getItem("lsuser")&&(o.user=JSON.parse(localStorage.getItem("lsuser"))),o.accessLevels=r,o.userRoles=n,{authorize:function(t,e){return void 0!==e?!0:!1},isLoggedIn:function(t){return void 0===t?t=o.user:void 0},register:function(t,o,r){return e.post("/register",t).success(o).error(r)},login:function(e,r){var n;return n=t.all("users"),n.getList({where:JSON.stringify({uNam:e.username})}).then(function(t){return t._items.length?(e=t._items[0],o.user=e,r(e)):void 0},function(){return $location.path("/")},function(){return o.error="Failed to login"})},logout:function(t,r){return e.post("/logout").success(function(){return o.user.uNam="",t()}).error(r)},accessLevels:r,userRoles:n}}])}.call(this),angular.module("ofApp").controller("AppCtrl",["$rootScope","$scope","$location","Auth",function(t,e,o,r){e.getUserRoleText=function(t){return _.invert(r.userRoles)[t]},e.logout=function(){r.logout(function(){o.path("/login")},function(){t.error="Failed to logout"})}}]),angular.module("ofApp").controller("LoginCtrl",["$rootScope","$scope","$location","Auth",function(t,e,o,r){t.activeNavItem="login",e.rememberme=!0,e.login=function(){localStorage.removeItem("lsuser"),r.login({username:e.username,password:e.password,rememberme:e.rememberme},function(){o.path("/")},function(){t.error="Failed to login"})}}]),angular.module("ofApp").controller("LogoutCtrl",["$rootScope","$location",function(t,e){localStorage.removeItem("lsuser"),delete t.user,e.path("/")}]),angular.module("ofApp").controller("HomeCtrl",["$rootScope",function(t){t.activeNavItem="home"}]),angular.module("ofApp").controller("RegisterCtrl",["$rootScope","$scope","$location","Auth",function(t,e,o,r){t.activeNavItem="register",e.role=routingConfig.userRoles.user,e.register=function(){r.register({username:e.username,password:e.password,role:e.role},function(e){t.user=e,o.path("/")},function(e){t.error=e})}}]),angular.module("ofApp").controller("PrivateCtrl",["$rootScope",function(t){t.activeNavItem="private"}]),angular.module("ofApp").controller("AdminCtrl",["$rootScope","$scope","Users",function(t,e,o){t.activeNavItem="admin",e.loading=!0,o.getAll(function(t){e.users=t,e.loading=!1},function(){t.error="Failed to fetch users.",e.loading=!1})}]),angular.module("ofApp").directive("accessLevel",["$rootScope","Auth",function(t,e){return{restrict:"A",link:function(o,r,n){var i=r.css("display");t.$watch("user.role",function(){e.authorize(n.accessLevel)?r.css("display",i):r.css("display","none")})}}}]).directive("autoFillableField",function(){return{restrict:"A",require:"?ngModel",link:function(t,e,o,r){setInterval(function(){""===e.val()&&r.$pristine||t.$apply(function(){r.$setViewValue(e.val())})},300)}}}),angular.module("ofApp").controller("MainCtrl",["$scope","Restangular",function(t,e){var o=e.all("plcs");t.plcs=o.getList()}]),function(){var t,e,o;e=function(t){return t.lat+","+t.lng},t=function(t){var e;return e=t.split(","),{lat:e[0],lng:e[1]}},o="img/map/sprites/",angular.module("ofApp").controller("PlcsCtrl",["$rootScope","$scope","$location","$routeParams","Restangular","$timeout","$log","$anchorScroll","GoogleMap",function(t,r,n,i,s,a,l,c,u){var p,h,d,g,m,f;return d=u,g=google.maps,m=d.map,h={cngSlug:"crherbs",cngAreaSlug:"br",cngAreaTerrSlug:"br06",q:"",sort:"bdry,w",filter:"cngAreaTerr:crherbs",z:18,pp:5,pg:5},r.items=[],r.lastItemsWithInfo=null,r.maxId=null,r.q=i.q||h.q,r.ll=i.ll||h.ll,r.z=parseInt(i.z,10)||h.z,r.pp=i.pp||h.pp,r.pg=i.pg||h.pg,r.sort=i.sort||h.sort,r.args=h,t.selectedItemIndex=d.selectedItem=d.selectedItemIndex=-1,r.bdys={crherbsbr06:{slug:"crherbsbr06",cPt:{lat:9.968179612738837,lng:-84.16628122329712},zoom:18,mapTypeId:"hybrid",nam:"Bosques Doña Rosa #06"}},r.cngAreaTerrs=[{slug:"crherbsbr06",nam:"br06-Bosques Doña Rosa 06"}],i.sort||(i.sort=h.sort),t.returnRoute=n.$$url,r.location=n,r.routeParams=i,t.$watch("selectedItemIndex",function(e){return r.selectedItem=t.selectedItem,t.selectedItemIndex=r.selectedItemIndex=e}),d.icon=function(t){return r.mkrIcon(t.mkrNo,t.mkrState)},r.itemMkrClick=function(o){var i;return t.selectedItemIndex=d.selectedItemIndex=r.selectedItemIndex=o,t.selectedItem=d.selectedItem=r.items[o],void 0!==r.items[o].pt&&(i=r.items[o].pt,r.ll=e(i)),n.hash("top"),c()},r.doSearch=function(){var t,e,o,s,a,l,c;if(t={},a=r.q,c={},"boolean"!=typeof i.cngAreaTerrId&&i.cngAreaTerrId&&(c.bdry=i.cngAreaTerrId),l=a.match(/qp\w+/g)){for(s=[],o=0;l.length>o;)console.log(l[o]),s.push(l[o].substr(2)),++o;c.id={$in:s},a=a.replace(/qp\w+\s*/g,"")}return a&&(c.dNam={$regex:a,$options:"i"}),c&&(t.where=JSON.stringify(c)),i.sort&&(t.sort=i.sort),p.getList(t).then(function(t){return r.items=t._items,r.q?n.search("q",r.q):void 0},e=function(){return console.log("Oops error from server :(")})},r.$watch("z",function(t){return n.search("z",t),r.z=parseInt(t,10)}),r.$watch("cngAreaTerrId",function(t){var e,o;return n.search("cngAreaTerrId",t),r.cngAreaTerrId=t,t&&"string"==typeof t&&i.cngAreaTerrId!==t?(e=r.bdys[t],o=e.cPt,m.setCenter(new google.maps.LatLng(o.lat,o.lng)),m.setZoom(e.zoom),m.setMapTypeId(e.mapTypeId),r.cngAreaTerrId=t,i.cngAreaTerrId=t):void 0}),r.$watch("routeParams",function(t){return angular.forEach(t,function(t,e){return"where"!==e?(r[e]=t,n.search(e,t)):void 0})},!0),p=s.all("plcs"),f={},r.doClear=function(){return r.q=r.location.q=r.routeParams.q=h.q,r.doSearch()},r.add=function(){var t;return t="doc="+JSON.stringify(r.newItem),p=s.all("plcs"),p.post(t).then(function(t){return r.newItem._id=t.doc._id,r.items.push(r.newItem),r.newItem={}})},r.remove=function(t){var e,o,a,l;return o=confirm("Are you absolutely sure you want to delete?"),o?(l=r.items[t],e=s.one("plcs",l._id),e.remove().then(function(){return r.items.splice(t,1)},a=function(){return console.log("Oops error from server :("),n.path("/plc/"+i.id)})):void 0},r.insert=function(){return n.path("/plc/insert")},r.edit=function(t){var e;return e=r.items[t],n.path("/plc/"+e._id+"/edit")},r.view=function(t){var e;return e=r.items[t],n.path("/plc/"+e._id)},r.mkrIcon=function(t,e){var r,n,i,s,a,l,c;return null==e&&(e=0),s=["new","try_1","try_1_contacted","try_2","try_2_contacted","try_3","try_3_contacted"],n=void 0,i=void 0,a=void 0,l=void 0,c=void 0,10>t?(a=o+"sprite_1.png",i=12,l=(t-1)*i,c=e*n):100>t?(a=o+"sprite_2.png",i=16,l=(t-10)*i,c=e*n):(a=o+"sprite_3.png",i=20,l=(t-100)*i,c=e*n),c&&(c+=1),t&&void 0!==e&&(r=new google.maps.MarkerImage(a,new google.maps.Size(i,12),new google.maps.Point(l,c))),r},r.doSearch()}]),angular.module("ofApp").controller("PlcFormCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(t,e,o,r,n){var i,s,a;return a="/plc/insert"===o.$$path,a?e.mode="Add New":(e.mode="Update",i=n.one("plcs",r.id),i.get().then(function(t){return e.dNam=t.dNam,e.item={},e.item._id=t._id||null,e.item.bdry=t.bdry||"",e.item.nam=t.nam||"",e.item.namS=t.namS||"",e.item.addr=t.addr,e.item.desc=t.desc,e.item.tags=void 0!==t.tags?t.tags.join(","):"",void 0!==t.pt?(e.item.lng=t.pt[0],e.item.lat=t.pt[1]):void 0},s=function(){return console.log("Oops error from server :(")})),e.remove=function(t){var e;return e=confirm("Are you absolutely sure you want to delete?"),e?(i=n.one("plcs",t._id),i.remove().then(function(){return o.path("/plcs")},s=function(){return console.log("Oops error from server :("),o.path("/plc/"+r.id)})):void 0},e.save=function(e){var o,r;return r={},console.log("save"),a?(r="doc="+JSON.stringify(e),o=n.all("plcs"),o.post(r).then(function(){return window.location.href="#"+t.returnRoute},s=function(){return console.log("Oops error from server :(")})):(e.tags=void 0!==e.tags&&e.tags>""?e.tags.split(","):[],void 0!==e.lng&&void 0!==e.lat&&(e.pt=[e.lng,e.lat],delete e.lat,delete e.lng),delete e._id,console.log("item",e),r=JSON.stringify({actions:{$set:{flds:e}}}),i.customPUT(void 0,void 0,void 0,r).then(function(){return window.location.href="#"+t.returnRoute},s=function(){return console.log("Oops error from server :(")}))},e.abandonChanges=function(){return o.path("/plc/"+e.item._id)}}]),angular.module("ofApp").controller("PlcViewCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(t,e,o,r,n){var i,s;return i=n.one("plcs",r.id),i.get().then(function(t){return e.item=t,void 0!==t.pt?(e.lng=t.pt[0],e.lat=t.pt[1]):void 0},s=function(){return console.log("Oops error from server :(")}),e.remove=function(e){var o;return o=confirm("Are you absolutely sure you want to delete?"),o?(i=n.one("plcs",e._id),i.remove().then(function(){return window.location.href="#"+t.returnRoute},s=function(){return console.log("Oops error from server :("),window.location.href="#"+t.returnRoute})):void 0},e.edit=function(t){return o.path("/plc/"+t._id+"/edit")}}])}.call(this);