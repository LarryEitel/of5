"use strict";angular.module("of5App",["restangular","ui.bootstrap","ui.keypress"]).constant("XCHGLAB_CONFIG",{API_KEY:"testkey"}).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl"}).when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://exi.xchg.com/api"),e.setListTypeIsArray(!1),e.setResponseExtractor(function(e){return e})}]),angular.module("of5App").controller("MainCtrl",["$scope","Restangular",function(e,t){var o=t.all("plcs");e.plcs=o.getList()}]),angular.module("of5App").controller("PlcsCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,t,o,r,n){var i={sort:"bdry,w",pp:5,pg:5};t.items=[],t.lastItemsWithInfo=null,t.maxId=null,t.q=r.q,t.pp=r.pp,t.pg=r.pg,t.args=i,r.sort||(r.sort=i.sort),e.returnRoute=o.$$url,t.location=o,t.routeParams=r,t.$watch("routeParams",function(e){return angular.forEach(e,function(e,t){return"where"!==t?o.search(t,e):void 0})},!0);var l=n.all("plcs");t.doClear=function(){t.q="",t.location.q="",t.routeParams.q="",t.doSearch()},t.doSearch=function(){var e=r;t.q&&(e.where=JSON.stringify({dNam:{$regex:t.q,$options:"i"}})),l.getList(e).then(function(e){t.items=e._items,t.q&&o.search("q",t.q)},function(){console.log("Oops error from server :(")})},t.add=function(){var e="doc="+JSON.stringify(t.newItem),o=n.all("plcs");o.post(e).then(function(e){t.newItem._id=e.doc._id,t.items.push(t.newItem),t.newItem={},t.myForm.$setPristine(),t.myForm.$pristine=!0})},t.remove=function(e){var i=confirm("Are you absolutely sure you want to delete?");if(i){var l=t.items[e],s=n.one("plcs",l._id);s.remove().then(function(){t.items.splice(e,1)},function(){return console.log("Oops error from server :("),o.path("/plc/"+r.id)})}},t.insert=function(){return o.path("/plc/insert")},t.edit=function(e){var r=t.items[e];return o.path("/plc/"+r._id+"/edit")},t.view=function(e){var r=t.items[e];return o.path("/plc/"+r._id)},t.doSearch()}]).controller("PlcFormCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,t,o,r,n){var i="/plc/insert"===o.$$path;if(i)t.mode="Add New";else{t.mode="Update";var l=n.one("plcs",r.id);l.get().then(function(e){t.dNam=e.dNam,t.item={},t.item._id=e._id||null,t.item.bdry=e.bdry||"",t.item.nam=e.nam||"",t.item.namS=e.namS||"",t.item.addr=e.addr,t.item.desc=e.desc,t.item.tags=void 0!==e.tags?e.tags.join(","):"",void 0!==e.pt&&(t.item.lng=e.pt[0],t.item.lat=e.pt[1])},function(){console.log("Oops error from server :(")})}t.remove=function(e){var t=confirm("Are you absolutely sure you want to delete?");if(t){var i=n.one("plcs",e._id);i.remove().then(function(){return o.path("/plcs")},function(){return console.log("Oops error from server :("),o.path("/plc/"+r.id)})}},t.save=function(t){var o={};if(console.log("save"),i){o="doc="+JSON.stringify(t);var r=n.all("plcs");r.post(o).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})}else t.tags=void 0!==t.tags&&t.tags>""?t.tags.split(","):[],void 0!==t.lng&&void 0!==t.lat&&(t.pt=[t.lng,t.lat],delete t.lat,delete t.lng),delete t._id,console.log("item",t),o=JSON.stringify({actions:{$set:{flds:t}}}),l.customPUT(void 0,void 0,void 0,o).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})},t.abandonChanges=function(){return o.path("/plc/"+t.item._id)}}]).controller("PlcViewCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,t,o,r,n){var i=n.one("plcs",r.id);i.get().then(function(e){t.item=e,void 0!==e.pt&&(t.lng=e.pt[0],t.lat=e.pt[1])},function(){console.log("Oops error from server :(")}),t.remove=function(t){var o=confirm("Are you absolutely sure you want to delete?");if(o){var r=n.one("plcs",t._id);r.remove().then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :("),window.location.href="#"+e.returnRoute})}},t.edit=function(e){return o.path("/plc/"+e._id+"/edit")}}]);