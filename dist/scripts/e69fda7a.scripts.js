"use strict";angular.module("of5App",["restangular","ui.bootstrap","ui.keypress"]).constant("XCHGLAB_CONFIG",{API_KEY:"testkey"}).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl"}).when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://exi.xchg.com/api"),e.setListTypeIsArray(!1),e.setResponseExtractor(function(e){return e})}]),angular.module("of5App").controller("MainCtrl",["$scope","Restangular",function(e,t){var r=t.all("plcs");e.plcs=r.getList()}]),angular.module("of5App").controller("PlcsCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){var n={sort:"bdry,-w",pp:5,pg:5};e.items=[],e.lastItemsWithInfo=null,e.maxId=null,e.q=r.q,e.pp=r.pp,e.pg=r.pg,e.args=n,r.sort||(r.sort=n.sort),e.location=t,e.routeParams=r,e.$watch("routeParams",function(e){return angular.forEach(e,function(e,r){return"where"!==r?t.search(r,e):void 0})},!0);var i=o.all("plcs");e.doClear=function(){e.q="",e.location.q="",e.routeParams.q="",e.doSearch()},e.doSearch=function(){var o=r;e.q&&(o.where=JSON.stringify({dNam:{$regex:e.q,$options:"i"}})),i.getList(o).then(function(r){e.items=r._items,e.q&&t.search("q",e.q)},function(){console.log("Oops error from server :(")})},e.add=function(){var t="doc="+JSON.stringify(e.newItem),r=o.all("plcs");r.post(t).then(function(t){e.newItem._id=t.doc._id,e.items.push(e.newItem),e.newItem={},e.myForm.$setPristine(),e.myForm.$pristine=!0})},e.remove=function(n){var i=confirm("Are you absolutely sure you want to delete?");if(i){var l=e.items[n],s=o.one("plcs",l._id);s.remove().then(function(){e.items.splice(n,1)},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.insert=function(){return t.path("/plc/insert")},e.edit=function(r){var o=e.items[r];return t.path("/plc/"+o._id+"/edit")},e.view=function(r){var o=e.items[r];return t.path("/plc/"+o._id)},e.doSearch()}]).controller("PlcFormCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){var n="/plc/insert"===t.$$path;if(n);else{var i=o.one("plcs",r.id);i.get().then(function(t){e.dNam=t.dNam,e.item={},e.item.nam=t.nam||"",e.item.namS=t.namS||"",e.item.addr=t.addr,e.item.desc=t.desc,e.item.tags=void 0!==t.tags?t.tags.join(","):"",void 0!==t.pt&&(e.item.lng=t.pt[0],e.item.lat=t.pt[1])},function(){console.log("Oops error from server :(")})}e.remove=function(e){var n=confirm("Are you absolutely sure you want to delete?");if(n){var i=o.one("plcs",e._id);i.remove().then(function(){return t.path("/plcs")},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.save=function(e){var r={};if(n){r="doc="+JSON.stringify(e);var l=o.all("plcs");l.post(r).then(function(){return t.path("/plcs/")},function(){console.log("Oops error from server :(")})}else void 0!==e.tags&&(e.tags=e.tags.split(",")),e.pts=[e.lng,e.lat],delete e.lat,delete e.lng,r=JSON.stringify({actions:{$set:{flds:e}}}),i.customPUT(void 0,void 0,void 0,r).then(function(e){return t.path("/plc/"+e.doc._id)},function(){console.log("Oops error from server :(")})},e.abandonChanges=function(){return t.path("/plc/"+e.item._id)}}]).controller("PlcViewCtrl",["$scope","$location","$routeParams","Restangular",function(e,t,r,o){var n=o.one("plcs",r.id);n.get().then(function(t){e.item=t,void 0!==t.pts&&(e.lat=t.pts[0],e.lng=t.pts[1])},function(){console.log("Oops error from server :(")}),e.remove=function(e){var n=confirm("Are you absolutely sure you want to delete?");if(n){var i=o.one("plcs",e._id);i.remove().then(function(){return t.path("/plcs")},function(){return console.log("Oops error from server :("),t.path("/plc/"+r.id)})}},e.edit=function(e){return t.path("/plc/"+e._id+"/edit")}}]);