"use strict";angular.module("ofApp",["restangular","ui.bootstrap","ui","google-maps"]).constant("XCHGLAB_CONFIG",{API_KEY:"testkey"}).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/plcs",{templateUrl:"views/plcs.html",controller:"PlcsCtrl"}).when("/plc/:id/edit",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/insert",{templateUrl:"views/plc-form.html",controller:"PlcFormCtrl"}).when("/plc/:id",{templateUrl:"views/plc-view.html",controller:"PlcViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.headers.common.Authorization="Basic admin@orgtec.com:xxxxxx",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://exi.xchg.com/api"),e.setListTypeIsArray(!1),e.setResponseExtractor(function(e){return e})}]).run(function(e){var r;r=e,r.navBarHeight=40}),angular.module("ofApp").controller("MainCtrl",["$scope","Restangular",function(e,r){var t=r.all("plcs");e.plcs=t.getList()}]),angular.module("ofApp").controller("PlcsCtrl",["$rootScope","$scope","$location","$routeParams","Restangular","$timeout","$log","$anchorScroll",function(e,r,t,o,n,a,l,i){var s={latitude:9.988002927,longitude:-84.20538052916},c=s;angular.extend(r,{position:{coords:c},centerProperty:c,zoomProperty:13,markersProperty:[{latitude:c.latitude,longitude:c.longitude,draggable:!0,mkrNo:6,mkrState:0}],clickedLatitudeProperty:null,clickedLongitudeProperty:null,eventsProperty:{click:function(e,r,t){l.log("user defined event on map directive with scope",this),l.log("user defined event: "+r,e,t)}}}),r.itemMkrClick=function(e){if(r.selectedItemIndex=e,void 0!==r.items[e].pt){var o=r.items[e].pt;r.position.coords={latitude:o[1],longitude:o[0]}}t.hash("top"),i()},r.gMap={},r.gMap.latLngFromLl=function(e){var r=e.split(",");return new google.maps.LatLng(r[0],r[1])};var u={ll:s,cngSlug:"crherbs",cngAreaSlug:"crherbsca",cngAreaTerrSlug:"crherbsca12",q:"",sort:"bdry,w",filter:"cngAreaTerr:crherbs",pp:5,pg:5};r.gMap.myMarkers=[],r.gMap.myMarkers.push(new google.maps.Marker({map:r.gMap.myMap,position:u.ll})),r.gMap.addMarker=function(e){r.gMap.myMarkers.push(new google.maps.Marker({map:r.gMap.myMap,position:e.latLng}))},r.items=[],r.lastItemsWithInfo=null,r.maxId=null,r.q=o.q||u.q,r.pp=o.pp||u.pp,r.pg=o.pg||u.pg,r.sort=o.sort||u.sort,r.args=u,r.cngs=[{slug:"crherbs",nam:"Belen Sur"}],r.cngAreas=[{bdry:"crherbs",slug:"crherbsca",nam:"Cariari"},{bdry:"crherbs",slug:"crherbsla",nam:"Los Arcos"}],r.cngAreaTerrs=[{bdry:"crherbsca",slug:"crherbsca01",nam:"CA-01 (bogus)"},{bdry:"crherbsca",slug:"crherbsca12",nam:"CA-12"},{bdry:"crherbsla",slug:"crherbsla01",nam:"LA-01 (bogus)"},{bdry:"crherbsla",slug:"crherbsla02",nam:"LA-02 (bogus)"}],o.sort||(o.sort=u.sort),e.returnRoute=t.$$url,r.location=t,r.routeParams=o,r.$watch("cngAreaTerrId",function(e){t.search("cngAreaTerrId",e),r.cngAreaTerrId=e}),r.$watch("routeParams",function(e){return angular.forEach(e,function(e,o){return"where"!==o?(r[o]=e,t.search(o,e)):void 0})},!0);var p=n.all("plcs");r.doClear=function(){r.q=r.location.q=r.routeParams.q=u.q,r.doSearch()},r.doSearch=function(){var e={},n={};r.q&&(n.dNam={$regex:r.q,$options:"i"}),"boolean"!=typeof o.cngAreaTerrId&&o.cngAreaTerrId&&(n.bdry=o.cngAreaTerrId),n&&(e.where=JSON.stringify(n)),o.sort&&(e.sort=o.sort),p.getList(e).then(function(e){r.items=e._items,r.q&&t.search("q",r.q)},function(){console.log("Oops error from server :(")})},r.add=function(){var e="doc="+JSON.stringify(r.newItem),t=n.all("plcs");t.post(e).then(function(e){r.newItem._id=e.doc._id,r.items.push(r.newItem),r.newItem={},r.myForm.$setPristine(),r.myForm.$pristine=!0})},r.remove=function(e){var a=confirm("Are you absolutely sure you want to delete?");if(a){var l=r.items[e],i=n.one("plcs",l._id);i.remove().then(function(){r.items.splice(e,1)},function(){return console.log("Oops error from server :("),t.path("/plc/"+o.id)})}},r.insert=function(){return t.path("/plc/insert")},r.edit=function(e){var o=r.items[e];return t.path("/plc/"+o._id+"/edit")},r.view=function(e){var o=r.items[e];return t.path("/plc/"+o._id)},r.doSearch()}]).controller("PlcFormCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,r,t,o,n){var a="/plc/insert"===t.$$path;if(a)r.mode="Add New";else{r.mode="Update";var l=n.one("plcs",o.id);l.get().then(function(e){r.dNam=e.dNam,r.item={},r.item._id=e._id||null,r.item.bdry=e.bdry||"",r.item.nam=e.nam||"",r.item.namS=e.namS||"",r.item.addr=e.addr,r.item.desc=e.desc,r.item.tags=void 0!==e.tags?e.tags.join(","):"",void 0!==e.pt&&(r.item.lng=e.pt[0],r.item.lat=e.pt[1])},function(){console.log("Oops error from server :(")})}r.remove=function(e){var r=confirm("Are you absolutely sure you want to delete?");if(r){var a=n.one("plcs",e._id);a.remove().then(function(){return t.path("/plcs")},function(){return console.log("Oops error from server :("),t.path("/plc/"+o.id)})}},r.save=function(r){var t={};if(console.log("save"),a){t="doc="+JSON.stringify(r);var o=n.all("plcs");o.post(t).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})}else r.tags=void 0!==r.tags&&r.tags>""?r.tags.split(","):[],void 0!==r.lng&&void 0!==r.lat&&(r.pt=[r.lng,r.lat],delete r.lat,delete r.lng),delete r._id,console.log("item",r),t=JSON.stringify({actions:{$set:{flds:r}}}),l.customPUT(void 0,void 0,void 0,t).then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :(")})},r.abandonChanges=function(){return t.path("/plc/"+r.item._id)}}]).controller("PlcViewCtrl",["$rootScope","$scope","$location","$routeParams","Restangular",function(e,r,t,o,n){var a=n.one("plcs",o.id);a.get().then(function(e){r.item=e,void 0!==e.pt&&(r.lng=e.pt[0],r.lat=e.pt[1])},function(){console.log("Oops error from server :(")}),r.remove=function(r){var t=confirm("Are you absolutely sure you want to delete?");if(t){var o=n.one("plcs",r._id);o.remove().then(function(){window.location.href="#"+e.returnRoute},function(){console.log("Oops error from server :("),window.location.href="#"+e.returnRoute})}},r.edit=function(e){return t.path("/plc/"+e._id+"/edit")}}]);